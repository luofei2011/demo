var $lf={version:"0.1",getElementByClassName:function(g){var f=g.slice(0,g.indexOf("."))||"",e=g.slice(g.indexOf(".")+1,g.length),a=[],b=0,d=new RegExp("\\b"+e+"\\b","g");var c=(f==="")?document.getElementsByTagName("*"):document.getElementsByTagName(f);for(;b<c.length;b++){if(d.test(c[b].className)){a.push(c[b])}}return a},data:(function(){var xmlhttp,responseText,activexName=["MSXML2.XMLHTTP","Microsoft.XMLHTTP"];if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest();if(xmlhttp.overrideMimeType){xmlhttp.overrideMimeType("text/xml")}}else{if(window.ActiveXObject){for(var i=0;i<activexName.length;i++){try{xmlhttp=new ActiveXObject(activexName[i]);break}catch(e){}}}}if(!xmlhttp){return}xmlhttp.onreadystatechange=callback;xmlhttp.open("GET","src/data.json",false);xmlhttp.send(null);function callback(){if(xmlhttp.readyState==4){if(xmlhttp.status==200||xmlhttp.status==0){var responseText=xmlhttp.responseText;data=eval("("+responseText+")")}}}return responseText})(),invitedArr:(function(){var c=data.invited,a=[];if(c.length){for(var b in c){a.push(c[b])}}return a})(),sprintf:function(c){var f=0,h=1,e=data.comment,b=c.target,a=b.length,d=b[f],g=c.max_value;return c.src.replace(/%s/g,function(){if(h>g){h=1;f+=1;d=b[f]}switch(h){case 1:h+=1;return e+d.urlToken;case 2:h+=1;return d.avatarPath;case 3:h+=1;return e+d.urlToken;case 4:h+=1;return d.fullName;case 5:h+=1;return d.bio;default:break}})},changeInvitedStatus:function(a){var c="";if(typeof a!=="undefined"){for(var b in data.recommended){if(data.recommended[b]["fullName"]===a){$lf.invitedArr.push(data.recommended[b])}}}if($lf.invitedArr.length){c+="您已邀请 <span class='person-list' id='person_list'><a href='"+data.comment+$lf.invitedArr[$lf.invitedArr.length-1]["urlToken"]+"'>"+$lf.invitedArr[$lf.invitedArr.length-1]["fullName"]+"</a><div class='invited-people' id='drop_invite'></div>";if($lf.invitedArr.length>1){c+=" , <a href='"+data.comment+$lf.invitedArr[$lf.invitedArr.length-2]["urlToken"]+"'>"+$lf.invitedArr[$lf.invitedArr.length-2]["fullName"]+"</a></span>";if($lf.invitedArr.length>2){c+=" 等"+$lf.invitedArr.length+"人"}}}return c},getDefaultStyle:function(b,a){return b.currentStyle?b.currentStyle[a]:document.defaultView.getComputedStyle(b,false)[a]},contains:function(a,b){if(a.contains){return a!=b&&a.contains(b)}else{return !!(a.compareDocumentPosition(b)&16)}},getEvent:function(a){return a||window.event},checkHover:function(b,a){if($lf.getEvent(b).type=="mouseover"){return !$lf.contains(a,$lf.getEvent(b).relatedTarget||$lf.getEvent(b).fromElement)&&!(($lf.getEvent(b).relatedTarget||$lf.getEvent(b).fromElement)===a)}else{return !$lf.contains(a,$lf.getEvent(b).relatedTarget||$lf.getEvent(b).toElement)&&!(($lf.getEvent(b).relatedTarget||$lf.getEvent(b).toElement)===a)}},slideUp:function(c,k){var g=$lf.getElementByClassName("ul.ul-list")[0],a=g.offsetHeight-1,k=k||{},d=c.style,e=k.speed||10,j=k.time||15,h,f=1,b=parseInt(a/e);c.style.height=0+"px";h=setTimeout(function(){if(f<b){c.style.height=f*e+"px";f+=1;setTimeout(arguments.callee,j)}else{c.style.height=a+"px";clearTimeout(h)}},j)},slideDown:function(h,d){var c=h.offsetHeight-9,d=d||{},a=h.style,b=d.speed||10,g=d.time||15,f,e=parseInt(c/b);f=setTimeout(function(){if(e>0){h.style.height=e*b+"px";e-=1;setTimeout(arguments.callee,g)}else{h.style.height=0;h.style.display="none";h.style.height=c+"px";clearTimeout(f)}},g)},addEvent:function(){var e=document.getElementById("person_list"),b=document.getElementById("drop_invite"),a=data.template2,c="";if(b!==null){for(var d=0;d<$lf.invitedArr.length;d++){c+=a}c=$lf.sprintf({src:c,target:$lf.invitedArr,max_value:4});b.innerHTML="<b class='icon'></b><b class='icon down'></b><ul class='ul-list'>"+c+"</ul>";e.onmouseover=function(g){if($lf.checkHover(g,this)){var f=$lf.getElementByClassName("span.person-list")[0].firstChild.offsetWidth;b.firstChild.style.left=f+"px";b.firstChild.nextSibling.style.left=f+"px";b.style.display="block";$lf.slideUp(b)}};e.onmouseout=function(f){if($lf.checkHover(f,this)){$lf.slideDown(b)}};$lf.addClickEvent()}},addClickEvent:function(){var c=document.getElementById("status"),b=$lf.getElementByClassName("a.right"),a=b.length;for(i=0;i<a;i++){b[i].onclick=function(){var e=this.previousSibling.innerHTML;$lf.removeInvited(e);c.innerHTML=$lf.changeInvitedStatus();var f=document.getElementsByTagName("button");console.log(f);for(var d=0;d<f.length;d++){if(f[d].nextSibling.innerHTML===e){f[d].className="send-invite";f[d].innerHTML="邀请回答"}}$lf.addEvent()}}},removeInvited:function(b){for(var a=0;a<$lf.invitedArr.length;a++){if($lf.invitedArr[a]["fullName"]===b){$lf.invitedArr.splice(a,1)}}},placeholder:function(a,b){a.value=b;a.onfocus=function(){if(this.value===b){this.value=""}};a.onblur=function(){if(this.value===""){this.value=b}}},start:function(){var d=document,a=d.getElementById("replace_ul"),c=a.getElementsByTagName("button"),f=d.getElementById("status"),e=d.getElementById("search-username"),b=data.template1;$lf.placeholder(e,"搜索您想邀请的人");b+=b.replace(/odd/g,"even");b+=b;newHtml=$lf.sprintf({src:b,target:data.recommended,max_value:5});a.innerHTML=newHtml;f.innerHTML=$lf.changeInvitedStatus();$lf.addEvent();for(i=0;i<c.length;i++){c[i].onclick=function(){if(this.innerHTML==="邀请回答"){this.className="remove-invite";this.innerHTML="收回邀请";f.innerHTML=$lf.changeInvitedStatus(this.nextSibling.innerHTML)}else{this.className="send-invite";this.innerHTML="邀请回答";$lf.removeInvited(this.nextSibling.innerHTML);f.innerHTML=$lf.changeInvitedStatus()}$lf.addEvent()}}}};